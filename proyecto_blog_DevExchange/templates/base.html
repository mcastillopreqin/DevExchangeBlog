{% load static %}
{% load colaborador_tags %}


<!DOCTYPE html>     
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
<nav>   
<div class="logo">
    <a href="{% url 'inicio' %}">D
        <img src="{% static 'img/logo_devexchange.png' %}" alt="Logo DevExchange" width="50" height="50">
    </a>
<nav> 
<ul class="nav-links">

    <li><a href="{% url 'inicio' %}">Inicio</a></li>
    <li><a href="#">Acerca de nosotros</a></li> 
    <li><a href="{% url 'lista_posts' %}">Preguntas</a></li>
    <li><a href="{% url 'app_contactos:contacto' %}">Contacto</a></li>
    <li><a href="{% url 'lista_etiquetas' %}">Etiquetas</a></li>           
<div class="dropdown">
{% if user.is_authenticated %}
    <p> Bienvenido</p> <h4>{{user.username}}</h4>
    <a href="{% url 'lista_posts' %}">Lista de Preguntas</a> |
    <li><a href="{% url 'logout' %}">{{ user.username }}: Cerrar Sesion</a></li>
    <dov class="dropdown-content">
      <table>       
        {% if user.is_superuser %}
        <tr>
            <td><a href="{% url 'admin:index' %}">Panel de Administracion</a></td>
        </tr>
        {% endif %}
        
       
        {% if user.is_superuser or request.user|has_group:"Colaborador" %}
        <tr>
            <td><a href="{% url 'lista_usuarios' %}">Lista de usuarios</a></td>
        </tr>
        {% endif %}        
        <tr>
            <td><a href="{% url 'lista_etiquetas'%}">Lista de Etiquetas</a></td>
        </tr>        
        </table>
{% else %}
    <a href="{% url 'login' %}">Iniciar Sesion</a> |
    <a href="{% url 'registro' %}">Registrarse</a>
{% endif %}
</div>

</ul>    
</nav>
<body>
    <div class="container">
        {% load static %}
        {% load colaborador_tags %}

        <!doctype html>
        <html lang="es">
            <head>
                <meta charset="utf-8">
                <meta name="viewport" content="width=device-width, initial-scale=1">
                <title>{% block title %}DevExchange Blog{% endblock title %}</title>
                <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
                <link rel="stylesheet" href="{% static 'css/site.css' %}">
                <style>
                    /* Estilos mínimos para la sidebar */
                    .sidebar {
                        min-height: 100vh;
                        padding-top: 1rem;
                        background-color: #0d6efd; /* Bootstrap primary */
                    }
                    .sidebar a { color: #fff; }
                    .sidebar .nav-link.active { background-color: rgba(255,255,255,0.08); }
                    .brand-small { width: 36px; height: 36px; object-fit: cover; }
                </style>
            </head>
            <body class="d-flex">

                <nav class="d-none d-lg-block col-lg-2 sidebar">
                    <div class="d-flex flex-column align-items-start p-3">
                        <a class="d-flex align-items-center mb-3 text-white text-decoration-none" href="{% url 'lista_posts' %}">
                            <img src="{% static 'img/logo_devexchange.png' %}" alt="logo" class="brand-small me-2">
                            <span class="fs-5">DevExchange</span>
                        </a>
                        <ul class="nav nav-pills flex-column mb-auto w-100">
                            <li class="nav-item"><a href="{% url 'lista_posts' %}" class="nav-link text-white">Preguntas</a></li>
                            <li class="nav-item"><a href="{% url 'app_contactos:contacto' %}" class="nav-link text-white">Contacto</a></li>
                            <li class="nav-item"><a href="{% url 'lista_etiquetas' %}" class="nav-link text-white">Etiquetas</a></li>
                        </ul>

                        <hr class="text-white-50 w-100">

                        {% if user.is_authenticated %}
                            <div class="ps-1 w-100">
                                <small class="text-white-50">Conectado como</small>
                                <div class="fw-bold text-white">{{ user.get_full_name|default:user.username }}</div>
                                <div class="mt-2">
                                    {% if user.is_superuser %}
                                        <a class="btn btn-sm btn-light mb-1 w-100" href="{% url 'admin:index' %}">Panel admin</a>
                                    {% endif %}
                                    {% if user.is_superuser or request.user|has_group:"Colaborador" %}
                                        <a class="btn btn-sm btn-outline-light mb-1 w-100" href="{% url 'lista_usuarios' %}">Usuarios</a>
                                    {% endif %}
                                    <a class="btn btn-sm btn-outline-light w-100" href="{% url 'logout' %}">Cerrar sesión</a>
                                </div>
                            </div>
                        {% else %}
                            <div class="ps-1 w-100">
                                <a class="btn btn-sm btn-light mb-1 w-100" href="{% url 'login' %}">Iniciar sesión</a>
                                <a class="btn btn-sm btn-outline-light w-100" href="{% url 'registro' %}">Registrarse</a>
                            </div>
                        {% endif %}
                    </div>
                </nav>

                <!-- Offcanvas para pantallas pequeñas -->
                <div class="d-lg-none">
                    <nav class="navbar navbar-dark bg-primary">
                        <div class="container-fluid">
                            <a class="navbar-brand d-flex align-items-center" href="{% url 'lista_posts' %}">
                                <img src="{% static 'img/logo_devexchange.png' %}" alt="logo" class="brand-small me-2">
                                <span>DevExchange</span>
                            </a>
                            <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileMenu" aria-controls="mobileMenu">
                                <span class="navbar-toggler-icon"></span>
                            </button>
                        </div>
                    </nav>

                    <div class="offcanvas offcanvas-start" tabindex="-1" id="mobileMenu" aria-labelledby="mobileMenuLabel">
                        <div class="offcanvas-header">
                            <h5 class="offcanvas-title" id="mobileMenuLabel">DevExchange</h5>
                            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                        </div>
                        <div class="offcanvas-body">
                            <ul class="list-unstyled">
                                <li><a class="d-block py-2" href="{% url 'lista_posts' %}">Preguntas</a></li>
                                <li><a class="d-block py-2" href="{% url 'app_contactos:contacto' %}">Contacto</a></li>
                                <li><a class="d-block py-2" href="{% url 'lista_etiquetas' %}">Etiquetas</a></li>
                            </ul>
                            <hr>
                            {% if user.is_authenticated %}
                                <div>{{ user.get_full_name|default:user.username }}</div>
                                <a class="d-block mt-2" href="{% url 'logout' %}">Cerrar sesión</a>
                            {% else %}
                                <a class="d-block" href="{% url 'login' %}">Iniciar sesión</a>
                                <a class="d-block mt-1" href="{% url 'registro' %}">Registrarse</a>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <main class="flex-grow-1 p-4">
                    {% if messages %}
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }}" role="alert">{{ message }}</div>
                        {% endfor %}
                    {% endif %}

                    {% block contenido %}{% endblock contenido %}
                </main>

                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
                {% block scripts %}{% endblock scripts %}
            </body>
        </html>